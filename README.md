# Example of a block root with a Verkle state root

## Block content

This is a standard RLP block containing 3 transactions, and an added `VerkleProof` field at the end of the block header.

```
> rlpdump block2.rlp
[
  # Block Header
  [
    0fd0698abc1aa285054f2cd0a6ca0b60e22150b6d1555c62b20d835d05a83570,
    1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347,
    0000000000000000000000000000000000000000,
    0bebeb2a8d3f8a2bb9a5b855851bbcb8ccdbdc9d6f7a441ec68e5fb620e865b4,
    54e9f2b1cb0cfecc2dbfbb0189c3a3483907a07421357d9a482cc75a2696a379,
    251f2cb798e965c5d9b11c882f37c69fd2c42b314fabe64d2b4998c76eb93ae8,
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
    020000,
    02, # Block Number
    47e7c4,
    f618,
    14,
    "",
    0000000000000000000000000000000000000000000000000000000000000000,
    0000000000000000,
    2dcf2261,

    # The serialized proof
000000000d0000000a0a0a0a0a0a0a0a0a0a0a0a0a06000000ec6d205b6beff33c492e18fc08c94b94ed386456e00314ace17cc7f9ee42d5e39755fbb89595223c3e690fa145b6023b7fd09d928612f5ac11c580186b8366075271fd087eda8cd7b1c6b672175857ac33c0c183be695983088e6b4943c3c38746e21b77c3f4b57860b7bfd44b2c184e444b05e6c5a2f645ec481de2ffa253553ff788d92a4bc59313428404cc5f8a9d2b17b33e1e2cc0bcd3c2f726bfdee15da5fed8c04e028c36c3f027a261fedc579767e220fcd2681357a2c98c227e8a467828a40d631eab96f575c8f88125b457199335df642a6bed4cc270a889de1a6f4beb5f6154cdac86ce4e1692f1c7dc610843642f56fc84fbdf1a8f839994c3b9cb676d5a41bba644c31a9d905966052785db3e53fe228f2e3a77f77275fe0ccbbe375e2ee8a8f9b75424f4f42f9fce760a08171777a37e5a6cf29994b2a1e4adbbfd1b61888563ccb3a47c594d31d0c81442b3563e46e067c119099e0fa909bd5f3d2411365f6cdfa9e41c7022cefc0e34080917bb69d77e86720017f1d28ad5b4f89d4b6b436172401ef178ea0f1f7ba34fb08e82f17071e779bcd71758db129d372c1d155eea56b5e509246f26851943e3d8fc0454fb14d2814840ccc76e29e255fd2387be37c1686c9727505398912ff26a72d99f2dab40f9bf5defafcc16ed0f75b3917ecef84eb431a11491da8b027b40303c27086aaee0f87ecbca77d35eaff8d9a58dfa8b66512b41f9c53ad42b59d857894eb70e970c805f396dc0a9b89bec0ea0a51dfd21d740ab8c2e857fa368febb146b0b73285b67a6afcd22a4ede5c581700634ddaaf6cb15abe9ac84ce17d635a983af01123a057d31297e0d31d67566e9f0485d9e7c464f5523a35e3498172394b7e6935aa200be62950ee2b6bc40244e03bdff7882ef4d53b4e4983d6736bddb8653f26caa91b6173ba3e211e8d736a32cf3bdeab0055dbffc95a906c65a2448e48c74c0e9235af814249d02a4e0be3e00886c7c578ec14d6ddb0c8840bdcb990c37319a5ed1b1581ee15aff4fcd9edefd781daae930838e3b2af884b1040dbbf8f70a5b7cc082763ae60a,

    # Serialized keys and values
    0d0000001802432d3b859ec3a1803854e8cceea75d092e52d0d4a4398d13022496745a03003102ea512b6f3237a2d4763cf49bf26de3b617fb0cabe38a97807a5549df4d0100e6026c222e3985050b4fc574b136b0a42c63538e9ab970995cd418ba8e526404001802432d3b859ec3a1803854e8cceea75d092e52d0d4a4398d13022496745a02001802432d3b859ec3a1803854e8cceea75d092e52d0d4a4398d13022496745a01001802432d3b859ec3a1803854e8cceea75d092e52d0d4a4398d13022496745a04003102ea512b6f3237a2d4763cf49bf26de3b617fb0cabe38a97807a5549df4d00003102ea512b6f3237a2d4763cf49bf26de3b617fb0cabe38a97807a5549df4d0200e6026c222e3985050b4fc574b136b0a42c63538e9ab970995cd418ba8e52640000e6026c222e3985050b4fc574b136b0a42c63538e9ab970995cd418ba8e52640100e6026c222e3985050b4fc574b136b0a42c63538e9ab970995cd418ba8e526402001802432d3b859ec3a1803854e8cceea75d092e52d0d4a4398d13022496745a0000e6026c222e3985050b4fc574b136b0a42c63538e9ab970995cd418ba8e52640300,
  ],
  
  # Tx list
  [
    [
      03,
      342770c0,
      5208,
      0102030000000000000000000000000000000000,
      03e7,
      "",
      "&",
      b1dc957ad929efeadb591bd77121aea2a1808c8a82e460d671aaccce2e96855a,
      38de06965d668cfaeb7d33d97e3c8e03380aac057741afa265756b32d07c43b0,
    ],
    [
      04,
      342770c0,
      5208,
      0000000000000000000000000000000000000000,
      03e7,
      "",
      "%",
      13c16fdd3018f4cdd2db8cd0cdf694973de65df7179bbb0c10de42583acaed7a,
      633d469034029959d960c23d3b028ae68360c1a4a66663f4d841aaca69b0c6eb,
    ],
    [
      05,
      342770c0,
      5208,
      0000000000000000000000000000000000000000,
      "",
      "",
      "%",
      640b2c69c75bedf0b9388e5b60e40ea6f4ea0a084b6660ab27ace0c66dfc04c7,
      52dc3febc7ca404f37b267a961de42ea35e6de362fcefc6f6928a830837f0ce5,
    ],
  ],
  [],
]
```

## Verkle proof format

This section is subject to change, so make sure that you watch this description as it will be udpated.

The verkle tree update adds two extra fields for the block: a proof and a list of (key, values) representing the _pre_ state of a block.

| Field | Block Header index | Description | Format |
| ----- | :----------------: | ----------- | ------ |
| Proof | 16 | Binary payload to pass to `rust-verkle` directly:<br /> * len(Proof of absence stem) ++ Proof of absence stems <br /> * len(depths) ++ serialize(depthi ++ ext statusi) <br /> * len(commitments) ++ serialize(commitment)<br /> * Multipoint proof | Flat binary
| Key, values | 17 | For each (key, value) par: <br /> * 32-byte key<br /> * marker byte: if `0` then value is not present, if `1` then value is present <br /> * 32-byte value, if present | Flat binary |

## Changelog

  * 22.01.22 - Initial version
  * 27.01.22:
    * proof and key,values lists are embedded in two distinct fields of the block (indices 16 and 17, respectively)
    * fix a duplicaiton issue for the commitments
    * remove the root commitment from the list
    * sort commitments by path

## TODO

 * [x] RLP encoding of the structure encapsulating the proof and the (key, values) tuples
 * [ ] SSZ encoding of that same structure when the final format has been defined
